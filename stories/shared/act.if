{
  "Tapestry:": [
    {
      "--": "State changing alters the state of a noun by changing a trait.",
      "Define action:requires:": [
        "state changing",
        [
          {
            "--": "the noun that wants to change state.",
            "Text:kind:": [
              "noun",
              "thing"
            ]
          },
          {
            "--": "the actor who is causing the state to change.",
            "Text:kind:": [
              "actor",
              "actor"
            ]
          },
          {
            "--": "the state the noun wants to change to.",
            "Text:": "trait"
          },
          {
            "--": "a trait which, if true, can block the noun from changing.",
            "Text:": "guard"
          },
          {
            "--": "some text which describes what's changing.",
            "Text:": "change"
          }
        ]
      ]
    },
    {
      "--": ""
    },
    {
      "--": "Assuming all the rules before now passed, give the noun the desired trait.",
      "Rule for:do:": [
        "state changing",
        {
          "Set:from:": [
            {
              "Object:field:": [
                "@noun",
                "@trait"
              ]
            },
            {
              "FromBool:": true
            }
          ]
        }
      ]
    },
    {
      "--": "Print the results of the change.",
      "Rule for:named:do:": [
        "report state changing",
        "the player changed something",
        {
          "If:do:else:": [
            {
              "IsPlayer obj:": {
                "FromText:": "@actor"
              }
            },
            {
              "Say response:with:": [
                "the player changed something",
                "{We!|capitalize!} {.change} {the: .noun}."
              ]
            },
            {
              "Else do:": {
                "Say response:with:": [
                  "something changed itself",
                  "{The: .noun|capitalize!} {are:.noun} {.trait}."
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "--": "The noun won't change if the 'guard' value is set and the noun has that trait.",
      "Rule for:named:do:": [
        "before state changing",
        "can't change the unchangeable",
        {
          "If:do:": [
            {
              "AllTrue:": [
                {
                  "Not:": {
                    "Is empty:": "@guard"
                  }
                },
                {
                  "Not:": {
                    "Object:field:": [
                      "@noun",
                      "@guard"
                    ]
                  }
                }
              ]
            },
            [
              {
                "Say response:with:": [
                  "can't change the unchangeable",
                  "{They: .noun|capitalize!} {arent: .noun} something {we!} can {.change}."
                ]
              },
              {
                "Set:from:": [
                  {
                    "Variable:dot:": [
                      "event",
                      {
                        "AtField:": "cancel"
                      }
                    ]
                  },
                  {
                    "FromBool:": true
                  }
                ]
              }
            ]
          ]
        }
      ]
    },
    {
      "--": "The noun won't change if it already has the desired trait.",
      "Rule for:named:do:": [
        "before state changing",
        "can't change what is",
        {
          "If:do:": [
            {
              "Object:field:": [
                "@noun",
                "@trait"
              ]
            },
            [
              {
                "Say response:with:": [
                  "can't change what is",
                  "{They: .noun|capitalize!} {are:.noun} already {.trait}."
                ]
              },
              {
                "Set:from:": [
                  {
                    "Variable:dot:": [
                      "event",
                      {
                        "AtField:": "cancel"
                      }
                    ]
                  },
                  {
                    "FromBool:": true
                  }
                ]
              }
            ]
          ]
        }
      ]
    }
  ]
}
