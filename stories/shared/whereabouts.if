[
  [
    {
      "KindOfRelation:cardinality oneToMany:": [
        "whereabouts",
        {
          "OneToMany:kinds:": [
            "object",
            "objects"
          ]
        }
      ]
    },
    {
      "Comment:": "The placement of objects in the game world.  One parent to many children. "
    }
  ],
  [
    {
      "PatternDecl:name:optvars:about:": [
        "patterns",
        "parentOf",
        {
          "PatternVariablesTail:": [
            {
              "Text named:of:": [
                "obj",
                "object"
              ]
            }
          ]
        },
        {
          "Comment:": "An object indicating the position or ownership of another: a kitchen with a cook, a cook holding a sack, a sack containing some flour. "
        }
      ]
    },
    {
      "PatternActions:patternReturn:patternRules:": [
        "parentOf",
        {
          "PatternReturn:": {
            "Text named:of:": [
              "parent",
              "object"
            ]
          }
        },
        {
          "PatternRules:": [
            {
              "PatternRule:hook activity:": [
                "Always",
                {
                  "Act:": [
                    {
                      "Let:be:": [
                        "parent",
                        {
                          "FromTxt:": {
                            "Reciprocal:object:": [
                              "whereabouts",
                              "@obj"
                            ]
                          }
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "PatternRule:hook activity:": [
                {
                  "KindOf:is:": [
                    "@obj",
                    "agents"
                  ]
                },
                {
                  "Act:": [
                    {
                      "Let:be:": [
                        "parent",
                        {
                          "FromTxt:": {
                            "Reciprocal:object:": [
                              "whereabouts",
                              {
                                "Get:from:": [
                                  "pawn",
                                  {
                                    "VarFields:": "obj"
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  [
    {
      "PatternDecl:name:optvars:": [
        "patterns",
        "parentsOf",
        {
          "PatternVariablesTail:": [
            {
              "Text named:of:": [
                "obj",
                "object"
              ]
            }
          ]
        }
      ]
    },
    {
      "PatternActions:patternLocals:patternReturn:patternRules:": [
        "parentsOf",
        {
          "PatternLocals:": [
            {
              "LocalDecl:value:": [
                {
                  "Text named:of:": [
                    "it",
                    "object"
                  ]
                },
                {
                  "LocalInit:": "@obj"
                }
              ]
            }
          ]
        },
        {
          "PatternReturn:": {
            "TextList named:": "list"
          }
        },
        {
          "PatternRules:": [
            {
              "PatternRule:hook activity:": [
                "Always",
                {
                  "Act:": [
                    {
                      "Repeating:do:": [
                        {
                          "Not:": {
                            "Is empty:": "@it"
                          }
                        },
                        {
                          "Act:": [
                            {
                              "Put:into:": [
                                "@it",
                                {
                                  "IntoTxts:": "list"
                                }
                              ]
                            },
                            {
                              "Let:be:": [
                                "it",
                                {
                                  "FromTxt:": {
                                    "Determine:arguments:": [
                                      "parentOf",
                                      {
                                        "Args:": [
                                          {
                                            "Arg:from:": [
                                              "obj",
                                              {
                                                "FromTxt:": "@it"
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  [
    {
      "PatternDecl:name:optvars:": [
        "patterns",
        "childrenOf",
        {
          "PatternVariablesTail:": [
            {
              "Text named:of:": [
                "obj",
                "object"
              ]
            }
          ]
        }
      ]
    },
    {
      "PatternActions:patternReturn:patternRules:": [
        "childrenOf",
        {
          "PatternReturn:": {
            "TextList named:": "kids"
          }
        },
        {
          "PatternRules:": [
            {
              "PatternRule:hook activity:": [
                "Always",
                {
                  "Act:": [
                    {
                      "Let:be:": [
                        "kids",
                        {
                          "FromTxts:": {
                            "Relatives:object:": [
                              "whereabouts",
                              "@obj"
                            ]
                          }
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  [
    {
      "PatternDecl:name:optvars:about:": [
        "patterns",
        "CurrentRoom",
        {
          "PatternVariablesTail:": [
            {
              "Text named:of:": [
                "obj",
                "object"
              ]
            }
          ]
        },
        {
          "Comment:": "The room in which an object can be found. "
        }
      ]
    },
    {
      "PatternActions:patternLocals:patternReturn:patternRules:": [
        "CurrentRoom",
        {
          "PatternLocals:": [
            {
              "LocalDecl:value:": [
                {
                  "Text named:of:": [
                    "search",
                    "object"
                  ]
                },
                {
                  "LocalInit:": {
                    "FromTxt:": "@obj"
                  }
                }
              ]
            }
          ]
        },
        {
          "PatternReturn:": {
            "Text named:of:": [
              "room",
              "room"
            ]
          }
        },
        {
          "PatternRules:": [
            {
              "PatternRule:hook activity:": [
                "Always",
                {
                  "Act:": [
                    {
                      "Repeating:do:": [
                        {
                          "Not:": {
                            "Is empty:": "@search"
                          }
                        },
                        {
                          "Act:": [
                            {
                              "If:do:": [
                                {
                                  "KindOf:is:": [
                                    "@search",
                                    "rooms"
                                  ]
                                },
                                {
                                  "Act:": [
                                    {
                                      "Let:be:": [
                                        "room",
                                        {
                                          "FromTxt:": "@search"
                                        }
                                      ]
                                    },
                                    "Break"
                                  ]
                                }
                              ]
                            },
                            {
                              "Let:be:": [
                                "search",
                                {
                                  "FromTxt:": {
                                    "Determine:arguments:": [
                                      "parentOf",
                                      {
                                        "Args:": [
                                          {
                                            "Arg:from:": [
                                              "obj",
                                              "@search"
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                }
                              ]
                            },
                            {
                              "If:do:": [
                                {
                                  "Cmp:is:txt:": [
                                    "@search",
                                    "Equals",
                                    "@obj"
                                  ]
                                },
                                {
                                  "Act:": [
                                    {
                                      "Comment:": "parent cycle detected"
                                    },
                                    "Break"
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  [
    {
      "PatternDecl:name:optvars:about:": [
        "patterns",
        "Common Ancestor",
        {
          "PatternVariablesTail:": [
            {
              "Text named:of:": [
                "object",
                "object"
              ]
            },
            {
              "Text named:of:": [
                "other object",
                "object"
              ]
            }
          ]
        },
        {
          "Comment:": "Finds the innermost object housing two objects. However, if one object directly encloses the other, it will return that object."
        }
      ]
    },
    {
      "PatternActions:patternLocals:patternReturn:patternRules:": [
        "Common Ancestor",
        {
          "PatternLocals:": [
            {
              "LocalDecl:": {
                "Text named:of:": [
                  "o1",
                  "object"
                ]
              }
            },
            {
              "LocalDecl:": {
                "Text named:of:": [
                  "o2",
                  "object"
                ]
              }
            }
          ]
        },
        {
          "PatternReturn:": {
            "Text named:of:": [
              "ancestor",
              "object"
            ]
          }
        },
        {
          "PatternRules:": [
            {
              "PatternRule:hook activity:": [
                "Always",
                {
                  "Act:": [
                    {
                      "Let:be:": [
                        "o1",
                        "@object"
                      ]
                    },
                    {
                      "Comment:": "we search every parent of the second object for every parent of the first object. slow but simple. "
                    },
                    {
                      "Repeating:do:": [
                        {
                          "Is empty:": "@ancestor"
                        },
                        {
                          "Act:": [
                            {
                              "Let:be:": [
                                "o2",
                                "@other object"
                              ]
                            },
                            {
                              "Repeating:do:": [
                                true,
                                {
                                  "Act:": [
                                    {
                                      "If:do:": [
                                        {
                                          "Cmp:is:txt:": [
                                            "@o1",
                                            "Equals",
                                            "@o2"
                                          ]
                                        },
                                        {
                                          "Act:": [
                                            {
                                              "Comment:": "success!"
                                            },
                                            {
                                              "Let:be:": [
                                                "ancestor",
                                                "@o2"
                                              ]
                                            },
                                            "Break"
                                          ]
                                        }
                                      ]
                                    },
                                    {
                                      "Let:be:": [
                                        "o2",
                                        {
                                          "FromTxt:": {
                                            "Determine:arguments:": [
                                              "ParentOf",
                                              {
                                                "Args:": [
                                                  {
                                                    "Arg:from:": [
                                                      "obj",
                                                      "@o2"
                                                    ]
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        }
                                      ]
                                    },
                                    {
                                      "If:do:else:": [
                                        {
                                          "Cmp:is:txt:": [
                                            "@o2",
                                            "Equals",
                                            "@other object"
                                          ]
                                        },
                                        {
                                          "Act:": [
                                            "Break"
                                          ]
                                        },
                                        {
                                          "ElseIf:do:": [
                                            {
                                              "Cmp:is:txt:": [
                                                "@o2",
                                                "Equals",
                                                ""
                                              ]
                                            },
                                            {
                                              "Act:": [
                                                "Break"
                                              ]
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "Let:be:": [
                                "o1",
                                {
                                  "FromTxt:": {
                                    "Determine:arguments:": [
                                      "ParentOf",
                                      {
                                        "Args:": [
                                          {
                                            "Arg:from:": [
                                              "obj",
                                              "@o1"
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                }
                              ]
                            },
                            {
                              "If:do:else:": [
                                {
                                  "Cmp:is:txt:": [
                                    "@o1",
                                    "Equals",
                                    "@object"
                                  ]
                                },
                                {
                                  "Act:": [
                                    {
                                      "Comment:": "parent cycle detected"
                                    },
                                    "Break"
                                  ]
                                },
                                {
                                  "ElseIf:do:": [
                                    {
                                      "Cmp:is:txt:": [
                                        "@o1",
                                        "Equals",
                                        ""
                                      ]
                                    },
                                    {
                                      "Act:": [
                                        {
                                          "Comment:": "out of world"
                                        },
                                        "Break"
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  [
    {
      "PatternDecl:name:": [
        "patterns",
        "ancestorOf"
      ]
    },
    {
      "Pattern:requires:": [
        "ancestorOf",
        [
          {
            "Text named:of:": [
              "obj",
              "object"
            ]
          },
          {
            "Text named:of:": [
              "root",
              "object"
            ]
          }
        ]
      ]
    },
    {
      "Comment:": "Returns true if the root is a parent of the object. "
    },
    {
      "PatternActions:patternLocals:patternReturn:patternRules:": [
        "ancestorOf",
        {
          "PatternLocals:": [
            {
              "LocalDecl:": {
                "Text named:of:": [
                  "up",
                  "object"
                ]
              }
            }
          ]
        },
        {
          "PatternReturn:": {
            "Bool named:desc:": [
              "isAncestor",
              "- true if one object acts as the ancestor of another."
            ]
          }
        },
        {
          "PatternRules:": [
            {
              "PatternRule:hook activity:": [
                "Always",
                {
                  "Act:": [
                    {
                      "Let:be:": [
                        "up",
                        {
                          "FromTxt:": "@obj"
                        }
                      ]
                    },
                    {
                      "Repeating:do:": [
                        true,
                        {
                          "Act:": [
                            {
                              "Comment:": "Step up immediately, indirect implies objects dont hold themselves."
                            },
                            {
                              "Let:be:": [
                                "up",
                                {
                                  "FromTxt:": {
                                    "Determine:arguments:": [
                                      "ParentOf",
                                      {
                                        "Args:": [
                                          {
                                            "Arg:from:": [
                                              "obj",
                                              "@up"
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                }
                              ]
                            },
                            {
                              "If:do:else:": [
                                {
                                  "Cmp:is:txt:": [
                                    "@up",
                                    "Equals",
                                    "@obj"
                                  ]
                                },
                                {
                                  "Act:": [
                                    {
                                      "Comment:": "parent cycle detected"
                                    },
                                    "Break"
                                  ]
                                },
                                {
                                  "ElseIf:do:": [
                                    {
                                      "Cmp:is:txt:": [
                                        "@up",
                                        "Equals",
                                        ""
                                      ]
                                    },
                                    {
                                      "Act:": [
                                        {
                                          "Comment:": "out of world"
                                        },
                                        "Break"
                                      ]
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "If:do:": [
                                {
                                  "Cmp:is:txt:": [
                                    "@up",
                                    "Equals",
                                    "@root"
                                  ]
                                },
                                {
                                  "Act:": [
                                    {
                                      "Comment:": "success!"
                                    },
                                    {
                                      "Let:be:": [
                                        "isAncestor",
                                        {
                                          "FromBool:": true
                                        }
                                      ]
                                    },
                                    "Break"
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  [
    {
      "PatternDecl:name:optvars:": [
        "patterns",
        "locationOf",
        {
          "PatternVariablesTail:": [
            {
              "Text named:of:": [
                "obj",
                "object"
              ]
            }
          ]
        }
      ]
    },
    {
      "Comment:": "Return the parent of an object if the parent is a valid enclosure. By default this means a room, a supporter, or a container. "
    },
    {
      "PatternActions:patternLocals:patternReturn:patternRules:": [
        "locationOf",
        {
          "PatternLocals:": [
            {
              "LocalDecl:value:": [
                {
                  "Text named:of:": [
                    "parent",
                    "object"
                  ]
                },
                {
                  "LocalInit:": {
                    "FromTxt:": {
                      "Determine:arguments:": [
                        "parentOf",
                        {
                          "Args:": [
                            {
                              "Arg:from:": [
                                "obj",
                                "@obj"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  }
                }
              ]
            }
          ]
        },
        {
          "PatternReturn:": {
            "Text named:of:": [
              "location",
              "object"
            ]
          }
        },
        {
          "PatternRules:": [
            {
              "PatternRule:hook activity:": [
                "Always",
                {
                  "Act:": [
                    {
                      "If:do:": [
                        {
                          "AnyTrue:": [
                            {
                              "KindOf:is:": [
                                "@parent",
                                "containers"
                              ]
                            },
                            {
                              "KindOf:is:": [
                                "@parent",
                                "supporters"
                              ]
                            },
                            {
                              "KindOf:is:": [
                                "@parent",
                                "rooms"
                              ]
                            }
                          ]
                        },
                        {
                          "Act:": [
                            {
                              "Let:be:": [
                                "location",
                                "@parent"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  [
    {
      "PatternDecl:name:optvars:": [
        "patterns",
        "SupporterOf",
        {
          "PatternVariablesTail:": [
            {
              "Text named:of:": [
                "obj",
                "object"
              ]
            }
          ]
        }
      ]
    },
    {
      "Comment:": "Return the parent of an object if the parent is a kind of supporter. "
    },
    {
      "PatternActions:patternLocals:patternReturn:patternRules:": [
        "SupporterOf",
        {
          "PatternLocals:": [
            {
              "LocalDecl:value:": [
                {
                  "Text named:of:": [
                    "parent",
                    "object"
                  ]
                },
                {
                  "LocalInit:": {
                    "FromTxt:": {
                      "Determine:arguments:": [
                        "parentOf",
                        {
                          "Args:": [
                            {
                              "Arg:from:": [
                                "obj",
                                "@obj"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  }
                }
              ]
            }
          ]
        },
        {
          "PatternReturn:": {
            "Text named:of:": [
              "supporter",
              "supporter"
            ]
          }
        },
        {
          "PatternRules:": [
            {
              "PatternRule:hook activity:": [
                "Always",
                {
                  "Act:": [
                    {
                      "If:do:": [
                        {
                          "KindOf:is:": [
                            "@parent",
                            "supporters"
                          ]
                        },
                        {
                          "Act:": [
                            {
                              "Let:be:": [
                                "supporter",
                                "@parent"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  [
    {
      "PatternDecl:name:optvars:": [
        "patterns",
        "ContainerOf",
        {
          "PatternVariablesTail:": [
            {
              "Text named:of:": [
                "obj",
                "object"
              ]
            }
          ]
        }
      ]
    },
    {
      "Comment:": "Return the parent of an object if the parent is a kind of container. "
    },
    {
      "PatternActions:patternLocals:patternReturn:patternRules:": [
        "ContainerOf",
        {
          "PatternLocals:": [
            {
              "LocalDecl:value:": [
                {
                  "Text named:of:": [
                    "parent",
                    "object"
                  ]
                },
                {
                  "LocalInit:": {
                    "FromTxt:": {
                      "Determine:arguments:": [
                        "parentOf",
                        {
                          "Args:": [
                            {
                              "Arg:from:": [
                                "obj",
                                "@obj"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  }
                }
              ]
            }
          ]
        },
        {
          "PatternReturn:": {
            "Text named:of:": [
              "container",
              "container"
            ]
          }
        },
        {
          "PatternRules:": [
            {
              "PatternRule:hook activity:": [
                "Always",
                {
                  "Act:": [
                    {
                      "If:do:": [
                        {
                          "KindOf:is:": [
                            "@parent",
                            "containers"
                          ]
                        },
                        {
                          "Act:": [
                            {
                              "Let:be:": [
                                "container",
                                "@parent"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  [
    {
      "PatternDecl:name:optvars:": [
        "patterns",
        "holderOf",
        {
          "PatternVariablesTail:": [
            {
              "Text named:of:": [
                "obj",
                "object"
              ]
            }
          ]
        }
      ]
    },
    {
      "Comment:": "Return the parent of an object if the parent is wearing or carrying the object. "
    },
    {
      "PatternActions:patternLocals:patternReturn:patternRules:": [
        "holderOf",
        {
          "PatternLocals:": [
            {
              "LocalDecl:": {
                "Text named:of:": [
                  "parent",
                  "object"
                ]
              }
            }
          ]
        },
        {
          "PatternReturn:": {
            "Text named:of:": [
              "owner",
              "actor"
            ]
          }
        },
        {
          "PatternRules:": [
            {
              "PatternRule:hook activity:": [
                "Always",
                {
                  "Act:": [
                    {
                      "Let:be:": [
                        "parent",
                        {
                          "FromTxt:": {
                            "Determine:arguments:": [
                              "parentOf",
                              {
                                "Args:": [
                                  {
                                    "Arg:from:": [
                                      "obj",
                                      "@obj"
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      ]
                    },
                    {
                      "If:do:": [
                        {
                          "KindOf:is:": [
                            "@parent",
                            "actors"
                          ]
                        },
                        {
                          "Act:": [
                            {
                              "Let:be:": [
                                "owner",
                                "@parent"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  [
    {
      "PatternDecl:name:optvars:": [
        "patterns",
        "CarrierOf",
        {
          "PatternVariablesTail:": [
            {
              "Text named:of:": [
                "obj",
                "object"
              ]
            }
          ]
        }
      ]
    },
    {
      "Comment:": "Return the parent of an object if the parent is carrying the object. Only actors can carry other objects. "
    },
    {
      "PatternActions:patternLocals:patternReturn:patternRules:": [
        "CarrierOf",
        {
          "PatternLocals:": [
            {
              "LocalDecl:": {
                "Text named:of:": [
                  "parent",
                  "object"
                ]
              }
            }
          ]
        },
        {
          "PatternReturn:": {
            "Text named:of:": [
              "carrier",
              "object"
            ]
          }
        },
        {
          "PatternRules:": [
            {
              "PatternRule:hook activity:": [
                "Always",
                {
                  "Act:": [
                    {
                      "Let:be:": [
                        "parent",
                        {
                          "FromTxt:": {
                            "Determine:arguments:": [
                              "parentOf",
                              {
                                "Args:": [
                                  {
                                    "Arg:from:": [
                                      "obj",
                                      "@obj"
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      ]
                    },
                    {
                      "If:do:": [
                        {
                          "AllTrue:": [
                            {
                              "KindOf:is:": [
                                "@parent",
                                "actors"
                              ]
                            },
                            {
                              "Get:from:": [
                                "not worn",
                                {
                                  "VarFields:": "obj"
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "Act:": [
                            {
                              "Let:be:": [
                                "carrier",
                                "@parent"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  [
    {
      "PatternDecl:name:optvars:": [
        "patterns",
        "WearerOf",
        {
          "PatternVariablesTail:": [
            {
              "Text named:of:": [
                "obj",
                "object"
              ]
            }
          ]
        }
      ]
    },
    {
      "Comment:": "Return the parent of an object if the parent is wearing the object.  Only actors can wear other objects. "
    },
    {
      "PatternActions:patternLocals:patternReturn:patternRules:": [
        "WearerOf",
        {
          "PatternLocals:": [
            {
              "LocalDecl:": {
                "Text named:of:": [
                  "parent",
                  "object"
                ]
              }
            }
          ]
        },
        {
          "PatternReturn:": {
            "Text named:of:": [
              "wearer",
              "object"
            ]
          }
        },
        {
          "PatternRules:": [
            {
              "PatternRule:hook activity:": [
                "Always",
                {
                  "Act:": [
                    {
                      "Let:be:": [
                        "parent",
                        {
                          "FromTxt:": {
                            "Determine:arguments:": [
                              "parentOf",
                              {
                                "Args:": [
                                  {
                                    "Arg:from:": [
                                      "obj",
                                      "@obj"
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      ]
                    },
                    {
                      "If:do:": [
                        {
                          "AllTrue:": [
                            {
                              "KindOf:is:": [
                                "@parent",
                                "actors"
                              ]
                            },
                            {
                              "Get:from:": [
                                "worn",
                                {
                                  "VarFields:": "obj"
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "Act:": [
                            {
                              "Let:be:": [
                                "wearer",
                                "@parent"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ]
]
